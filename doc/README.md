# NRF24L01

Наявність двох або більше плат Arduino, здатних спілкуватися між собою бездротово на відстані, 
відкриває безліч можливостей, таких як 
віддалений моніторинг даних датчиків, управління роботами, домашня автоматизація та інше. 
І коли справа зводиться до недорогих, але надійних двосторонніх радіочастотних рішень, є декілька варіантів:
- ZeegBee - [ліцензований протокол](https://web.archive.org/web/20100216234546/http://freaklabs.org/index.php/Blog/Zigbee/Zigbee-Linux-and-the-GPL.html), лідер ринку IoT комунікацій
- nRF24L01 - [Nordic Semiconductor](https://www.nordicsemi.com/Products/Low-power-short-range-wireless/nRF24-series)
- Bluetooth
- WiFi

Модуль трансивера nRF24L01 + (плюс) часто можна отримати в Інтернеті 
за [менше одного долара США](https://ru.aliexpress.com/wholesale?SearchText=nrf24l01), 
що робить його одним з найдешевших варіантів передачі даних, які є сьогодні на ринку. 
І найкраще, що ці модулі є надзвичайно крихітними, що дозволяє включати бездротовий інтерфейс майже в будь-який проект.

## Інтерфейси та характеристики

### Радіочастота

Модуль приймача nRF24L01 + призначений для роботи в частотному діапазоні частот [ISM (industrial, scientific and medical)](https://uk.wikipedia.org/wiki/ISM) 2,4 ГГц 
і використовує модуляцію Гаусову модуляцію ([GFSK](https://web.archive.org/web/20110119025729/http://digital.sibsutis.ru/WLL/GMSK.htm)) для передачі даних. 
Швидкість передачі даних конфігурується программою мікроконтроллера, та може бути 250kbps, 1Mbps та 2Mbps.

### Споживання енергії

Робоча напруга модуля становить від 1,9 до 3,6 В, але гарна новина полягає в тому, 
що логічні штифти мають 5-вольтовий толерантність, 
тому ми можемо легко підключити його до Arduino або будь-якого логічного мікроконтролера 5В, 
не використовуючи жодного логічного перетворювача рівня.

Модуль підтримує програмовану вихідну потужність, а саме. 0 дБм, -6 дБм, -12 дБм або -18 дБм 
і споживає неймовірно близько 12 мА під час передачі при 0 дБм, що навіть нижче, ніж у одного світлодіода. 
А найкраще, що він споживає 26 мкА в режимі очікування та 900 нА в режимі відключення живлення. 
Тому можна розробляти такі пристрої з радіоінтерфейсом, які будуть працювати роками від батарейного живлення.

### SPI інтерфейс

Модуль приймача nRF24L01 + підключається до мікроконтроллера через 4-контактний послідовний периферійний інтерфейс (SPI) 
з максимальною швидкістю передачі даних 10Мбіт / с. 
Всі параметри, такі як 
- частотний канал (125 каналів, що вибираються), 
- вихідна потужність (0 дБм, -6 дБм, -12 дБм або -18 дБм) 
- швидкість передачі даних (250 кбіт / с, 1 Мбіт / с або 2 Мбіт / с), 
можуть бути налаштовані через інтерфейс SPI.

Шина SPI використовує концепцію Master і Slave, в більшості поширених застосувань Arduino - це Master, а модуль приймача nRF24L01 + - Slave. 

Таблиця характеристик модуля:

| Характеристика | Значення |
| ----------- | ----------- |
| Діапазон частот      | 2.4 GHz, ISM діапазон       |
| Максимальна швидкість передачі даних   | 2 Mb/s        |
| Формат модуляції | Гаусову модуляція |
| Робоча напруга живлення | від 1.9 В до 3.6 В |
| Максимальний струм | 13.5mA |
| Мінімальний струм (в режимі очікування) | 
| Логічний вхід | 3-5 В |
| Дальність передачі сигналу | до 800 м прямої видимості |


### Зовнішній вигляд модуля NRF24L01

На основі чіпа nRF24L01 + доступні різноманітні модулі. 
Нижче представлені найпопулярніші версії.

![Стандартна версія модуля NRF24L01](images/nrf24l01-module-standard.jpg)
![SMD весія модуля NRF24L01](images/nrf24l01-module-smd.jpg)

Перший варіант з антеною на платі. 
Таким чином плата виходить більш компактною. 
Однак менша антена також означає меншу дальність передачі. 
Ця версія модуля здатна вести передачу до 100 метрів в зоні прямої видимості. 
У приміщенні зі стінами, відстань передачі буде меншою.

![NRF24L01 з підсилювачем](images/NRF24L01-PA-LNA.jpg)

Друга версія має коаксіальний роз'єм та duck-антену, але це не єдина відмінність. 
Справжня відмінність полягає в тому, що модуль поставляється зі спеціальним 
[RFX2401C](http://ultran.ru/sites/default/files/rfx2401c_eval_board_summary_and_technical_notes_revb1.pdf) чіпом. 
Цей чіп разом з duck антеною допомагає модулю 
досягти значно більшого діапазону передачі, близько 1000 м.

### Що таке PA LNA [link](https://electronics.stackexchange.com/questions/237267/what-is-a-pa-lna)

PA означає посилювач потужності (Power Amplifier).
Це збільшує потужність сигналу, що передається з чіпа nRF24L01. 
Тоді як LNA розшифровується як підсилювач з низьким рівнем шуму (Low-Noise Amplifier). 
Функція LNA полягає в тому, 
щоб приймати надзвичайно слабкий і невизначений сигнал з антени 
(як правило, на порядок мікровольт або менше -100 дБм) 
і посилити його на більш корисний рівень (зазвичай приблизно від 0,5 до 1 В)

LNA та PA підключаються до антени через дуплекспер, 
який розділяє два сигнали і запобігає відносно потужному виходу PA 
від перевантаження чутливого входу LNA.

![SMD весія модуля NRF24L01](images/PA-LNA.png)

### Принцип роботи nRF24L01

#### Канал 

Модуль приймача nRF24L01 передає та приймає дані на певній частоті (Канал або Channel). 
Також для того, щоб два або більше модулів приймача могли спілкуватися один з одним, 
вони повинні знаходитися на одному каналі.  
Цей канал може бути будь-якої частоти в діапазоні ISM 2,4 ГГц або, 
якщо бути точнішим, він може бути від 2,400 до 2,525 ГГц (2400 до 2525 МГц).

Кожен канал займає смугу пропускання менше 1 МГц.  
Це дає нам 125 можливих каналів з інтервалом 1 МГц. 
Отже, модуль може використовувати 125 різних каналів, 
що дає можливість мати мережу з 125 незалежно працюючих модулів в одному місці.

#### nRF24L01+ MultiCeiver (TM) Network

NRF24L01 + надає функцію під назвою Multiceiver. 
Це абревіатура для декількох передавачів одного приймача. 
У якому кожен радіочастотний канал логічно розділений на 6 паралельних каналів даних, 
що називаються Data Pipes. 
Іншими словами, канал даних - це логічний канал у фізичному радіочастотному каналі. 
Кожна передача даних має свою фізичну адресу (Data Pipe Address) і може бути налаштована. 
Це можна проілюструвати, як показано нижче.

![Multiceiver data pipes](images/multiceiver_data_pipes.jpg)

PRX нода, настроєна на пройом з 6 різних нод передавачів. 
Приймач може перестати слухати будь-який час і виконувати функцію передавача,
але в такому разі він зможе передавати лише в один pipe одночасно.

#### Enhanced ShockBurst протокол


183/5000
Модуль приймача nRF24L01 + використовує структуру пакетів, 
відому як Enhanced ShockBurst. 
Ця проста структура пакетів розбита на 5 різних полів, що проілюстровано нижче.

![Enhanced ShockBurst Protocol](images/enhanced_shockBurst_protocol.jpg)

Початкова структура ShockBurst складалася лише з полів преамбули, 
адреси, корисного навантаження та перевірки циклічної надмірності (CRC). 
Enhanced ShockBurst забезпечив більшу функціональність для покращеної комунікації 
за допомогою нещодавно введеного Packet Control Field (PCF).

Ця нова структура чудова з кількох причин. 
По-перше, вона дозволяє змінювати довжину корисних навантажень 
із специфікатором довжини корисного навантаження, 
тобто корисні навантаження можуть змінюватись від 1 до 32 байт.

По-друге, він надає кожному відправленому пакету ідентифікатор пакета, 
що дозволяє пристрою, що приймає, визначати, чи є повідомлення новим, 
чи воно було повторно передано (і, таким чином, його можна ігнорувати).

Нарешті, і найголовніше, кожне повідомлення може вимагати надсилання підтвердження, 
коли воно отримане іншим пристроєм.

